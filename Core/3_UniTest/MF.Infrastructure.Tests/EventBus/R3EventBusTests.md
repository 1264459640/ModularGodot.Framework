# R3EventBus 测试用例文档

## 1. 测试概述

`R3EventBus` 是一个基于 R3 的事件总线实现，用于在应用程序中发布和订阅事件。本文档旨在描述针对该事件总线的各项测试用例，以确保其功能的正确性和稳定性。

## 2. 测试环境

- .NET 6.0
- R3
- 单元测试框架：xUnit 或 NUnit

## 3. 测试用例

### 3.1 初始化测试

- **用例名称**: 初始化事件总线
- **测试目的**: 验证事件总线能否正确初始化
- **前置条件**: 无
- **测试步骤**:
  1. 创建 `IGameLogger<R3EventBus>` 实例
  2. 创建 `R3EventBus` 实例
- **预期结果**: 事件总线成功初始化，无异常抛出

### 3.2 异步发布事件测试

- **用例名称**: 异步发布事件
- **测试目的**: 验证能否正确异步发布事件
- **前置条件**: 事件总线已初始化
- **测试步骤**:
  1. 创建一个测试事件实例
  2. 调用 `PublishAsync` 方法发布事件
- **预期结果**: 事件成功发布，无异常抛出

### 3.3 同步发布事件测试

- **用例名称**: 同步发布事件
- **测试目的**: 验证能否正确同步发布事件
- **前置条件**: 事件总线已初始化
- **测试步骤**:
  1. 创建一个测试事件实例
  2. 调用 `Publish` 方法发布事件
- **预期结果**: 事件成功发布，无异常抛出

### 3.4 订阅事件测试

- **用例名称**: 订阅事件
- **测试目的**: 验证能否正确订阅事件
- **前置条件**: 事件总线已初始化
- **测试步骤**:
  1. 创建一个事件处理函数
  2. 调用 `Subscribe` 方法订阅事件
  3. 发布一个事件
- **预期结果**: 事件处理函数被正确调用

### 3.5 异步订阅事件测试

- **用例名称**: 异步订阅事件
- **测试目的**: 验证能否正确异步订阅事件
- **前置条件**: 事件总线已初始化
- **测试步骤**:
  1. 创建一个异步事件处理函数
  2. 调用 `Subscribe` 方法订阅事件
  3. 发布一个事件
- **预期结果**: 异步事件处理函数被正确调用

### 3.6 带过滤条件的订阅事件测试

- **用例名称**: 带过滤条件的订阅事件
- **测试目的**: 验证能否正确订阅带过滤条件的事件
- **前置条件**: 事件总线已初始化
- **测试步骤**:
  1. 创建一个带过滤条件的事件处理函数
  2. 调用 `Subscribe` 方法订阅事件
  3. 发布多个事件，其中部分事件满足过滤条件
- **预期结果**: 只有满足过滤条件的事件被处理

### 3.7 一次性订阅事件测试

- **用例名称**: 一次性订阅事件
- **测试目的**: 验证能否正确一次性订阅事件
- **前置条件**: 事件总线已初始化
- **测试步骤**:
  1. 创建一个事件处理函数
  2. 调用 `SubscribeOnce` 方法订阅事件
  3. 发布一个事件
  4. 再次发布一个事件
- **预期结果**: 事件处理函数只被调用一次

### 3.8 释放资源测试

- **用例名称**: 释放事件总线资源
- **测试目的**: 验证能否正确释放事件总线资源
- **前置条件**: 事件总线已初始化
- **测试步骤**:
  1. 调用 `Dispose` 方法释放资源
  2. 尝试发布或订阅事件
- **预期结果**: 资源被正确释放，后续操作会抛出 `ObjectDisposedException`

## 4. 测试覆盖率

- 功能测试: 100%
- 边界测试: 50% (主要测试了正常流程，缺少对极端情况的测试)
- 异常测试: 75% (测试了部分异常情况，如发布已释放的事件总线)

## 5. 测试结论

通过以上测试用例的执行，可以确保 `R3EventBus` 的功能正确性和稳定性。建议增加更多极端情况和异常场景的测试，以提高测试覆盖率。