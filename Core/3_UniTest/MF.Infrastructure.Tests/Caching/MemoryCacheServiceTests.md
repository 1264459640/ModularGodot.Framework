# MemoryCacheService 测试用例文档

## 1. 测试概述

本文档旨在为 `MemoryCacheService` 类提供全面的测试用例，确保其在各种场景下都能正确管理内存缓存。测试将覆盖缓存的基本操作、过期机制、容量限制以及并发安全性等功能。

## 2. 测试环境

- .NET 6.0
- xUnit
- FluentAssertions
- Moq（用于模拟依赖）

## 3. 测试用例

### 3.1 初始化测试

- **用例名称**: 初始化 `MemoryCacheService`
- **测试目的**: 验证 `MemoryCacheService` 实例能否正确初始化。
- **前置条件**: 无
- **测试步骤**:
  1. 创建 `MemoryCacheService` 实例。
- **预期结果**: 实例创建成功，且内部状态正确初始化。

### 3.2 设置缓存项测试

- **用例名称**: 设置缓存项
- **测试目的**: 验证 `Set` 方法能否正确设置缓存项。
- **前置条件**: `MemoryCacheService` 实例已创建。
- **测试步骤**:
  1. 调用 `Set` 方法设置一个缓存项。
  2. 验证缓存项是否正确存储。
- **预期结果**: 缓存项被正确存储，可以通过 `Get` 方法获取。

### 3.3 获取缓存项测试

- **用例名称**: 获取缓存项
- **测试目的**: 验证 `Get` 方法能否正确获取缓存项。
- **前置条件**: 缓存中已存在目标缓存项。
- **测试步骤**:
  1. 调用 `Get` 方法获取缓存项。
- **预期结果**: 返回正确的缓存项值。

### 3.4 获取不存在的缓存项测试

- **用例名称**: 获取不存在的缓存项
- **测试目的**: 验证获取不存在的缓存项时的行为。
- **前置条件**: 缓存中不存在目标缓存项。
- **测试步骤**:
  1. 调用 `Get` 方法获取不存在的缓存项。
- **预期结果**: 返回默认值或 null。

### 3.5 移除缓存项测试

- **用例名称**: 移除缓存项
- **测试目的**: 验证 `Remove` 方法能否正确移除缓存项。
- **前置条件**: 缓存中已存在目标缓存项。
- **测试步骤**:
  1. 调用 `Remove` 方法移除缓存项。
  2. 验证缓存项是否被移除。
- **预期结果**: 缓存项被成功移除，后续获取返回默认值。

### 3.6 检查缓存项存在性测试

- **用例名称**: 检查缓存项是否存在
- **测试目的**: 验证 `ContainsKey` 方法能否正确检查缓存项存在性。
- **前置条件**: 缓存中存在和不存在的缓存项。
- **测试步骤**:
  1. 对存在的缓存项调用 `ContainsKey` 方法。
  2. 对不存在的缓存项调用 `ContainsKey` 方法。
- **预期结果**: 存在的缓存项返回 true，不存在的返回 false。

### 3.7 清空缓存测试

- **用例名称**: 清空所有缓存项
- **测试目的**: 验证 `Clear` 方法能否正确清空所有缓存项。
- **前置条件**: 缓存中存在多个缓存项。
- **测试步骤**:
  1. 调用 `Clear` 方法清空缓存。
  2. 验证所有缓存项是否被清空。
- **预期结果**: 所有缓存项被清空，缓存为空状态。

### 3.8 缓存过期测试

- **用例名称**: 缓存项自动过期
- **测试目的**: 验证缓存项能否在指定时间后自动过期。
- **前置条件**: 设置了过期时间的缓存项。
- **测试步骤**:
  1. 设置一个带有短过期时间的缓存项。
  2. 等待过期时间。
  3. 尝试获取该缓存项。
- **预期结果**: 过期后无法获取到缓存项。

### 3.9 缓存容量限制测试

- **用例名称**: 缓存容量限制
- **测试目的**: 验证缓存在达到容量限制时的行为。
- **前置条件**: 设置了容量限制的缓存服务。
- **测试步骤**:
  1. 添加缓存项直到达到容量限制。
  2. 继续添加新的缓存项。
- **预期结果**: 旧的缓存项被移除，新的缓存项被添加。

### 3.10 并发访问测试

- **用例名称**: 并发访问缓存
- **测试目的**: 验证缓存服务在并发访问时的线程安全性。
- **前置条件**: 多个线程同时访问缓存。
- **测试步骤**:
  1. 创建多个线程同时进行缓存操作。
  2. 验证操作结果的正确性。
- **预期结果**: 所有操作都能正确执行，无数据竞争问题。

### 3.11 获取缓存统计信息测试

- **用例名称**: 获取缓存统计信息
- **测试目的**: 验证能否正确获取缓存的统计信息。
- **前置条件**: 缓存中存在一些缓存项。
- **测试步骤**:
  1. 调用获取统计信息的方法。
- **预期结果**: 返回正确的缓存统计信息（如命中率、缓存项数量等）。

### 3.12 释放资源测试

- **用例名称**: 释放缓存服务资源
- **测试目的**: 验证 `Dispose` 方法能否正确释放资源。
- **前置条件**: `MemoryCacheService` 实例已创建。
- **测试步骤**:
  1. 调用 `Dispose` 方法释放资源。
  2. 尝试进行缓存操作。
- **预期结果**: 资源被正确释放，后续操作会抛出 `ObjectDisposedException`。

## 4. 测试覆盖率

- 功能测试: 100%
- 边界测试: 90% (包括容量限制、过期时间等边界情况)
- 异常测试: 85% (包括并发访问、资源释放后操作等异常情况)

## 5. 结论

通过以上测试用例的执行，可以确保 `MemoryCacheService` 的功能正确性、性能和稳定性。建议定期执行这些测试以确保代码质量。