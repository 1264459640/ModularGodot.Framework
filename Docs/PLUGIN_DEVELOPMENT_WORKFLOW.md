# 插件化架构开发与协作工作流

本文档总结了在当前插件化架构下的开发、分发、安装和社区协作的最佳实践。

## 一、核心原则：契约优先 (Contract-First)

整个架构的核心是分离“契约”与“实现”。

- **契约 (Contracts)**：定义了“系统能做什么”。它是一系列 C# 接口，存放在一个共享的、中立的 `MF.Contracts` 项目中。这个项目是框架的一部分，定义了所有插件可以实现的扩展点。
- **实现 (Implementation)**：定义了“系统如何做”。每个插件都是一个独立的实现项目，它引用 `MF.Contracts` 项目，并提供一个或多个接口的具体实现。

## 二、插件的生命周期

### 1. 打包 (Packaging)

当插件开发完成时，应将其打包成一个独立的 `.zip` 文件，其中包含：

- **插件程序集 (`.dll`)**：插件的核心实现代码。
- **资源文件**：插件所需的场景 (`.tscn`)、图片、音频等。
- **依赖项 (可选)**：插件自身依赖的、而框架未提供的第三方库。
- **清单文件 (可选)**：一个 `plugin.json` 文件，描述插件的元数据（名称、版本、作者、实现的接口等）。

**关键**：插件包**不应该**包含 `MF.Contracts.dll`。

### 2. 安装 (Installation)

将插件 `.zip` 包解压，并将解压后的整个文件夹复制到主程序根目录下的 `Extensions` 文件夹中。

框架启动时会自动扫描此目录，加载所有插件的 DLL，并将其中的服务实现注册到依赖注入容器中。

### 3. 卸载 (Uninstallation)

直接从 `Extensions` 目录中删除对应的插件文件夹即可。

框架下次启动时将不会加载该插件，与之相关的功能将自动失效，但不会影响主程序的运行。

## 三、社区协作与版本迭代

当第三方开发者需要一个当前 `MF.Contracts` 中不存在的新接口时，为避免阻塞开发和社区测试，应遵循以下“Fork & Develop”工作流：

1.  **Fork 仓库**：开发者 Fork 框架的官方代码仓库，得到一份自己可控的副本。

2.  **在 Fork 中添加接口**：在自己 Fork 的代码中，向 `MF.Contracts` 项目添加所需的接口。

3.  **提交 PR (Pull Request)**：在开发的同时，向官方仓库提交一个 PR，请求将新接口合并到官方的 `MF.Contracts` 中。

4.  **并行开发与社区测试**：
    - 在等待官方审核 PR 期间，开发者可以基于自己修改过的 `MF.Contracts` 进行插件开发和调试。
    - 可以发布**预发布 (Pre-release)** 版本的插件。
    - 发布此测试版时，需要**同时提供**一份由他自己编译的、包含新接口的**非官方 `MF.Contracts.dll`**，并告知测试者需要临时替换此文件才能运行。

5.  **切换回官方版本**：
    - 一旦官方框架接受 PR 并发布了包含新接口的正式版，插件作者应立即更新自己的项目。
    - 将插件的项目引用从“非官方 `MF.Contracts`”切换回“官方新版 `MF.Contracts`”。
    - 重新编译并发布插件的**正式版**。该版本将不再需要捆绑特殊的 `MF.Contracts.dll`。

这个流程保证了开发的敏捷性，同时通过向官方提交 PR 维护了整个生态系统的长期一致性和稳定性。